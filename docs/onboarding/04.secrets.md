# 管理密钥

> **场景**：应用需要管理 API Keys、Tokens、密钥等敏感信息
> **预计时间**：15 分钟
> **前置条件**：已完成[部署第一个应用](./02.first-app.md)

---

## 概述

- **1Password** 是密钥真源（静态密钥）
- **Vault** 是运行时真理
- **Dokploy 环境变量** 是最后一公里

---

## 快速开始：添加一个 API Key

### 步骤 1: 写入 Vault

```bash
export VAULT_ADDR=https://vault.${INTERNAL_DOMAIN}
vault login ${VAULT_TOKEN}
vault kv put secret/platform/<env>/my-app OPENAI_API_KEY=sk-xxx
```
如未开通或无 Vault 权限，请联系运维代为写入。

### 步骤 2: 配置 Dokploy 环境变量

在应用的 Dokploy Env 中添加：
```
OPENAI_API_KEY=sk-xxx
```

### 步骤 3: 在代码中使用

```javascript
const apiKey = process.env.OPENAI_API_KEY;
```

---

## 使用 env_tool 读写远端

```bash
# 读取 Vault 密钥
invoke env.get OPENAI_API_KEY --project=platform --env=production --service=my-app

# 写入 Vault 密钥
invoke env.set OPENAI_API_KEY=sk-xxx --project=platform --env=production --service=my-app

# 预览（masked）
invoke env.list-all --project=platform --service=my-app
```

---

## 密钥轮换

1. 更新 Vault 中的值
2. 更新 Dokploy Env
3. 重启应用容器
